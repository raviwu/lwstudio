<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Go | 陣列（Array） - Ravi Wu</title><link rel="icon" type="image/png" href=favicon.ico /><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Go | 陣列（Array）" />
<meta property="og:description" content="Go 的陣列是連續空間內儲存了固定數目之相同型別物件的容器。當使用 var array [5]int 宣告時，陣列內儲存的型別或者長度都不能再改變，如果需要更多的空間來儲存新的物件，需要宣告一個新的陣列後把原先的值搬過去新的陣列。
在 Go 語言中宣告新的變數且無賦值時，這些變數所指向的物件都會以其零值（Zero Value）初始化。有關於 Go 的零值，請參考這邊。常用的零值：
   類型 零值     數值 0   布林值 false   字串 &quot;&quot;    初始化陣列的同時賦值 // 宣告一個 array1 變數的 int 陣列，長度為 5 且值依序分別為 1,2,3,4,5 array1 := [5]int{1,2,3,4,5} // 宣告一個 array2 變數的 int 陣列，長度為 5 且值依序分別為 0,1,2,0,0 array2 := [5]int{1: 1, 2: 2} // 宣告一個 array3 變數的 int 陣列，長度為取決於賦值內容 // 如以下 array3 的長度為 3 array3 := [." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://raviwu.github.io/posts/go-array/" />
<meta property="article:published_time" content="2020-10-26T11:36:46+08:00" />
<meta property="article:modified_time" content="2020-10-26T11:36:46+08:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Go | 陣列（Array）"/>
<meta name="twitter:description" content="Go 的陣列是連續空間內儲存了固定數目之相同型別物件的容器。當使用 var array [5]int 宣告時，陣列內儲存的型別或者長度都不能再改變，如果需要更多的空間來儲存新的物件，需要宣告一個新的陣列後把原先的值搬過去新的陣列。
在 Go 語言中宣告新的變數且無賦值時，這些變數所指向的物件都會以其零值（Zero Value）初始化。有關於 Go 的零值，請參考這邊。常用的零值：
   類型 零值     數值 0   布林值 false   字串 &quot;&quot;    初始化陣列的同時賦值 // 宣告一個 array1 變數的 int 陣列，長度為 5 且值依序分別為 1,2,3,4,5 array1 := [5]int{1,2,3,4,5} // 宣告一個 array2 變數的 int 陣列，長度為 5 且值依序分別為 0,1,2,0,0 array2 := [5]int{1: 1, 2: 2} // 宣告一個 array3 變數的 int 陣列，長度為取決於賦值內容 // 如以下 array3 的長度為 3 array3 := [."/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel="stylesheet">

	<link rel="stylesheet" type="text/css" media="screen" href="https://raviwu.github.io/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://raviwu.github.io/css/main.css" />
	<link rel="stylesheet" type="text/css" href="https://raviwu.github.io/css/custom.css" />
	<link rel="stylesheet" type="text/css" href="https://raviwu.github.io/css/dark.css"  />
	<link rel="stylesheet" type="text/css" href="https://raviwu.github.io/css/custom-dark.css"  />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
	<script src="https://raviwu.github.io/js/main.js"></script>
	<script src="https://raviwu.github.io/js/abc.js"></script>
	<script src="https://raviwu.github.io/js/xyz.js"></script>
	<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
</head>

<body>
	<div class="container wrapper post">
		<div class="header">
	<base href="https://raviwu.github.io/">
	<h1 class="site-title"><a href="https://raviwu.github.io/">Ravi Wu</a></h1>
	<div class="site-description"><h2>random thoughts and notes, beware if you want to reference</h2><nav class="nav social">
			<ul class="flat"><a href="https://github.com/raviwu" title="Github"><i data-feather="github"></i></a><a href="https://www.linkedin.com/in/raviwu/" title="Linkedin"><i data-feather="linkedin"></i></a><a href="/index.xml" title="RSS"><i data-feather="rss"></i></a></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">All posts</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h1 class="title">Go | 陣列（Array）</h1>
			<div class="meta">Posted at &mdash; Oct 26, 2020</div>
		</div>

		<div class="markdown">
			<p>Go 的陣列是連續空間內儲存了固定數目之相同型別物件的容器。當使用 <code>var array [5]int</code> 宣告時，陣列內儲存的型別或者長度都不能再改變，如果需要更多的空間來儲存新的物件，需要宣告一個新的陣列後把原先的值搬過去新的陣列。</p>
<p>在 Go 語言中宣告新的變數且無賦值時，這些變數所指向的物件都會以其零值（Zero Value）初始化。有關於 Go 的零值，請參考<a href="https://dave.cheney.net/2013/01/19/what-is-the-zero-value-and-why-is-it-useful">這邊</a>。常用的零值：</p>
<table>
<thead>
<tr>
<th>類型</th>
<th>零值</th>
</tr>
</thead>
<tbody>
<tr>
<td>數值</td>
<td>0</td>
</tr>
<tr>
<td>布林值</td>
<td>false</td>
</tr>
<tr>
<td>字串</td>
<td>&quot;&quot;</td>
</tr>
</tbody>
</table>
<h2 id="初始化陣列的同時賦值">初始化陣列的同時賦值</h2>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#586e75">// 宣告一個 array1 變數的 int 陣列，長度為 5 且值依序分別為 1,2,3,4,5
</span><span style="color:#586e75"></span>array1 <span style="color:#719e07">:=</span> [<span style="color:#2aa198">5</span>]<span style="color:#dc322f">int</span>{<span style="color:#2aa198">1</span>,<span style="color:#2aa198">2</span>,<span style="color:#2aa198">3</span>,<span style="color:#2aa198">4</span>,<span style="color:#2aa198">5</span>}

<span style="color:#586e75">// 宣告一個 array2 變數的 int 陣列，長度為 5 且值依序分別為 0,1,2,0,0
</span><span style="color:#586e75"></span>array2 <span style="color:#719e07">:=</span> [<span style="color:#2aa198">5</span>]<span style="color:#dc322f">int</span>{<span style="color:#2aa198">1</span>: <span style="color:#2aa198">1</span>, <span style="color:#2aa198">2</span>: <span style="color:#2aa198">2</span>}

<span style="color:#586e75">// 宣告一個 array3 變數的 int 陣列，長度為取決於賦值內容
</span><span style="color:#586e75">// 如以下 array3 的長度為 3
</span><span style="color:#586e75"></span>array3 <span style="color:#719e07">:=</span> [<span style="color:#719e07">...</span>]<span style="color:#dc322f">int</span>{<span style="color:#2aa198">1</span>,<span style="color:#2aa198">2</span>,<span style="color:#2aa198">3</span>}
</code></pre></div><h2 id="陣列的操作">陣列的操作</h2>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#586e75">// 宣告一個 array 變數的 int 陣列，長度為 3 且值依序分別為 1,2,3
</span><span style="color:#586e75"></span>array <span style="color:#719e07">:=</span> [<span style="color:#2aa198">3</span>]<span style="color:#dc322f">int</span>{<span style="color:#2aa198">1</span>,<span style="color:#2aa198">2</span>,<span style="color:#2aa198">3</span>}

<span style="color:#586e75">// 把 index 2 的值改為 5
</span><span style="color:#586e75"></span>array[<span style="color:#2aa198">2</span>] = <span style="color:#2aa198">5</span>
</code></pre></div><h2 id="使用指標為陣列的值">使用指標為陣列的值</h2>
<p>初始化 <code>array := [3]*int{0: new(int), 1: new(int)}</code> 時：</p>
<table>
<thead>
<tr>
<th>index</th>
<th>0</th>
<th>1</th>
<th>2</th>
</tr>
</thead>
<tbody>
<tr>
<td>array[index]</td>
<td>0xc0000b6020</td>
<td>0xc0000b6028</td>
<td>nil</td>
</tr>
<tr>
<td>*array[index]</td>
<td>0</td>
<td>0</td>
<td><code>error: cannot use assignment (array[i]) = (nil) as value</code></td>
</tr>
</tbody>
</table>
<p>試試看改變陣列指標的值 <code>*array[0] = 100</code> ：</p>
<table>
<thead>
<tr>
<th>index</th>
<th>0</th>
<th>1</th>
<th>2</th>
</tr>
</thead>
<tbody>
<tr>
<td>array[index]</td>
<td>0xc0000b6020</td>
<td>0xc0000b6028</td>
<td>nil</td>
</tr>
<tr>
<td>*array[index]</td>
<td>0</td>
<td>100</td>
<td><code>error: cannot use assignment (array[i]) = (nil) as value</code></td>
</tr>
</tbody>
</table>
<p>這邊可以注意到，指標的記憶體位址是一樣的，但值改變了。</p>
<p>假如想要替現在為 <code>nil</code> 的位置指定值，首先要在記憶體裡做出一個指標。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">i <span style="color:#719e07">:=</span> <span style="color:#2aa198">200</span>
array[<span style="color:#2aa198">2</span>] = <span style="color:#719e07">&amp;</span>i
</code></pre></div><p>透過 <code>i := 200</code> 的方式宣告了 <code>i</code> 以後，使用 <code>&amp;i</code> 取得 <code>i</code> 的指標並賦值給 <code>array[2]</code> 後，會變成：</p>
<table>
<thead>
<tr>
<th>index</th>
<th>0</th>
<th>1</th>
<th>2</th>
</tr>
</thead>
<tbody>
<tr>
<td>array[index]</td>
<td>0xc0000b6020</td>
<td>0xc0000b6028</td>
<td>0xc0000b6038</td>
</tr>
<tr>
<td>*array[index]</td>
<td>0</td>
<td>100</td>
<td>200</td>
</tr>
</tbody>
</table>
<p>假如另外再賦值另一個變數 <code>j</code> 時，指標位址會變：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">j <span style="color:#719e07">:=</span> <span style="color:#2aa198">200</span>
array[<span style="color:#2aa198">2</span>] = <span style="color:#719e07">&amp;</span>j
</code></pre></div><p>這邊例外宣告了變數 <code>j</code> 給整數 200，其實是另外在記憶體裡找了一塊地方塞值 200 給指標 <code>j</code>，到此， <code>i</code> 跟 <code>j</code> 的位置不同，但值相同。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">i <span style="color:#719e07">:=</span> <span style="color:#2aa198">200</span>
j <span style="color:#719e07">:=</span> <span style="color:#2aa198">200</span>
k <span style="color:#719e07">:=</span> j

i <span style="color:#719e07">==</span> j <span style="color:#586e75">// true
</span><span style="color:#586e75"></span>k <span style="color:#719e07">==</span> j <span style="color:#586e75">// true
</span><span style="color:#586e75"></span>
<span style="color:#719e07">&amp;</span>i <span style="color:#719e07">==</span> <span style="color:#719e07">&amp;</span>j <span style="color:#586e75">// false
</span><span style="color:#586e75"></span><span style="color:#719e07">&amp;</span>k <span style="color:#719e07">==</span> <span style="color:#719e07">&amp;</span>j <span style="color:#586e75">// false
</span><span style="color:#586e75"></span>
k = <span style="color:#2aa198">300</span>
k <span style="color:#719e07">==</span> j <span style="color:#586e75">// false
</span></code></pre></div><p>突然跳來實驗一下 Go 的指標，可以發現每 <code>:=</code> 了一個指標，都是在記憶體裡拿一塊新的區域來存值，這幾個指標都是不同位置，所以假若 <code>*k</code> 被改值時不會影響到 <code>i</code> 或 <code>j</code> 這兩個指標所指向的值。</p>
<table>
<thead>
<tr>
<th>index</th>
<th>0</th>
<th>1</th>
<th>2</th>
</tr>
</thead>
<tbody>
<tr>
<td>array[index]</td>
<td>0xc0000b6020</td>
<td>0xc0000b6028</td>
<td>0xc0000b6058</td>
</tr>
<tr>
<td>*array[index]</td>
<td>0</td>
<td>100</td>
<td>200</td>
</tr>
</tbody>
</table>
<p>重新指定一個指標給 <code>array[2] = new(int)</code> 也是一樣的意思：</p>
<table>
<thead>
<tr>
<th>index</th>
<th>0</th>
<th>1</th>
<th>2</th>
</tr>
</thead>
<tbody>
<tr>
<td>array[index]</td>
<td>0xc0000b6020</td>
<td>0xc0000b6028</td>
<td>0xc0000b6078</td>
</tr>
<tr>
<td>*array[index]</td>
<td>0</td>
<td>100</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>要注意的是，如果複製以指標為值的陣列時，指標的位置會一樣：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">array1 <span style="color:#719e07">:=</span> [<span style="color:#2aa198">2</span>]<span style="color:#719e07">*</span><span style="color:#dc322f">int</span>{<span style="color:#2aa198">0</span>: <span style="color:#b58900">new</span>(<span style="color:#dc322f">int</span>), <span style="color:#2aa198">1</span>: <span style="color:#b58900">new</span>(<span style="color:#dc322f">int</span>)}
array1[<span style="color:#2aa198">0</span>] = <span style="color:#2aa198">1</span>
array1[<span style="color:#2aa198">1</span>] = <span style="color:#2aa198">2</span>

array2 <span style="color:#719e07">:=</span> array1
</code></pre></div><p>可以發現 <code>array1</code> 跟 <code>array2</code> 裡頭放的指標，地址都是一樣的。</p>
<table>
<thead>
<tr>
<th>index</th>
<th>0</th>
<th>1</th>
</tr>
</thead>
<tbody>
<tr>
<td>array1[index]</td>
<td>0xc0000b6020</td>
<td>0xc0000b6028</td>
</tr>
<tr>
<td>array2[index]</td>
<td>0xc0000b6020</td>
<td>0xc0000b6028</td>
</tr>
<tr>
<td>*array1[index]</td>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>*array2[index]</td>
<td>1</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>當然，這就表示，如果改動指標指向的值，兩個陣列都會被影響，請注意！</p>
<h2 id="傳送陣列給函數">傳送陣列給函數</h2>
<p>由於 Golang 的函數是傳值（passed by value），所以把陣列直接傳進去函數裡面，對於程式效能會有負面影響。</p>
<p>可以試試看下面的實驗：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#586e75">// 宣告一個 8MB 的陣列
</span><span style="color:#586e75"></span><span style="color:#268bd2">var</span> array [<span style="color:#2aa198">1e6</span>]<span style="color:#dc322f">int</span>

<span style="color:#586e75">// 把陣列直接傳到 foo 函數裡
</span><span style="color:#586e75"></span><span style="color:#268bd2">foo</span>(array)

<span style="color:#586e75">// foo 直接接收陣列
</span><span style="color:#586e75"></span><span style="color:#268bd2">func</span> <span style="color:#268bd2">foo</span>(array [<span style="color:#2aa198">1e6</span>]<span style="color:#dc322f">int</span>) {
    <span style="color:#719e07">...</span>
}
</code></pre></div><p>每一次 <code>foo</code> 這個函數被呼叫，就會有 8MB 的空間在 stack 被取用。然後傳入的陣列會被複製到這個新取用的空間裡。即使你的機器可以處理這樣的負載，但其實有更好的方式。</p>
<h3 id="使用指標pointer作為參數">使用指標（Pointer）作為參數</h3>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#268bd2">var</span> array [<span style="color:#2aa198">1e6</span>]<span style="color:#dc322f">int</span>

<span style="color:#268bd2">foo</span>(<span style="color:#719e07">&amp;</span>array)

<span style="color:#268bd2">func</span> <span style="color:#268bd2">foo</span>(array <span style="color:#719e07">*</span>[<span style="color:#2aa198">1e6</span>]<span style="color:#dc322f">int</span>) {
    <span style="color:#719e07">...</span>
}
</code></pre></div><p>這麼做，呼叫 <code>foo</code> 的時候就不會浪費額外的記憶體空間去複製傳入的值，而是使用 <code>array</code> 這個已經建立好的陣列。</p>
<p>但這麼做要小心函數是否對於這個參數的值做改變，由於傳入的是指標，所以對於陣列的值做任何改變時，同一個記憶體中的數值會被更改。</p>

		</div>

		<div class="post-tags">
			
				
					<nav class="nav tags">
							<ul class="flat">
								
								<li><a href="/tags/go">go</a></li>
								
								<li><a href="/tags/array">array</a></li>
								
								<li><a href="/tags/coding">coding</a></li>
								
								<li><a href="/tags/data-structure">data structure</a></li>
								
							</ul>
					</nav>
				
			
		</div>
		</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> Copyright © 2020 | Ravi Wu |  <a href="https://github.com/vividvilla/ezhil">Ezhil theme</a> | Built with <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>



<script>feather.replace()</script>
</body>
</html>
